<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

    <title>Construtor de cartões</title>
</head>

<body onload="main()">

    <div class="bg-light pt-3 pb-3">
        <div class="container">
            <h1 class="display-4">Criar cartões personalizados</h1>

        </div>
    </div>
    <div class="container-fluid">
        <div class=" mb-3">
            <p class="lead">Nome do Emissor</p>
            <input type="text" id="idEmissor">
        </div>
        <div class="mb-3">
            <p class="lead">Nome do Destinário</p>
            <input type="text" id="idDestinatario">
        </div>
    </div>
    <div class="display-6 fs-6 container-fluid bg-light pt-3 pb-3 border border-success p-2 mb-2 ">
        <div class=" mb-3">
            <div>
                <button type="submit" id="idBtnMessage" style="width: 10rem; height:3rem;" class="btn btn-primary">Gerar
                    Mensagem</button>
                <p class="lead" id="idTextMessage"></p>
            </div>
        </div>
    </div>
    <div class="container-fluid">
        <div class=" row mt-3 mb-3">
            <p class="lead">Selecione uma imagem</p>
            <input class="picture__input form-control form-control" accept="image/*" id="idFile" type="file">
            <input type="image" id="idImg" width="250px">
        </div>
        <div class="mb-3">
            <a href="" "https://placehold.co/350x150/000000/FFF"> </a>
            <img src="https://placehold.co/200x200/black/white">
        </div>
    </div>

    <div class="display-6 fs-6 container-fluid bg-light pt-3 pb-3 border border-success p-2 mb-2 ">
        <div class=" mb-3">
            <div>
                <p class="lead">Clique no botão Criar Cartão</p>
                <button type="submit" id="idBtnCard" style="width: 10rem; height:3rem;" class="btn btn-primary">Criar
                </button>
                <p class="lead" id="idTextMessage"></p>
            </div>
        </div>
    </div>


    <div class="container">
        <div id="cards" class="row mt-3">
            <!-- Content goes here -->
        </div>
    </div>
    </form>



    <!-- Option 1: Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous">

        </script>
    <script src="gerarmensagem.js" type="function/json"> </script>
    <script>
        function main() {

            const btnMensagem = document.getElementById("idBtnMessage");
            const txtMensagem = document.getElementById("idTextMessage");
            const emissor = document.getElementById("idEmissor");
            const destinatario = document.getElementById("idDestinatario");
            const btnCriarCard = document.getElementById("idBtnCard");
            const inputFile = document.getElementById('idFile');
            const pictureImage = document.getElementById('idImg');
            const cards = document.getElementById('cards');

            let NomeEmissor = "";
            let NomeDestina = "";
            let mensagem = txtMensagem.value;


            //função para criar card

            btnCriarCard.addEventListener("click", buildCards);

            inputFile.addEventListener('change', function (e) {
                const inputTarget = e.target;
                const file = inputTarget.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.addEventListener('load', function (e) {
                        const ReaderTarget = e.target;
                       const img = document.createElement('img');
                        img.src = ReaderTarget.result;
                      
                       pictureImage.classList.add('img');
                        pictureImage.innerHTML = '';
                       pictureImage.appendChild(img);
                       
                    });
                        reader.readAsDataURL(file);
                    }else
                        {
                            pictureImage.innerHTML = pictureImage.text;
                        }
            });
        

        
        function buildCards() {
            cards.innerHTML = "";

            function addCard(NomeEmissor, source, message, NomeDestina) {
                return '<div class="card border-success mb-3" style="max-width: 18rem;">' +
                    '<div class=" lead card-header bg-transparent border-success"> Para: ' + NomeDestina + '</div>' +
                    '<div class="card-body text-success">' +
                    '   <img src=\.."' + source + '" class="card-img-top" alt="...">' +
                    ' <h5 class="card-title">Message </h5>' +
                    '<p class="card-text">' + message + '</p>' +
                    '</div>' +
                    '<div class="lead card-footer bg-transparent border-success"> De: ' + NomeEmissor + '</div>' +
                    '</div>'
            }


            cards.innerHTML += addCard(emissor.value, imgSource.value, destinatario.value);//escreve na página de HTML

        }




        //funcão para gerar a mensagem
        btnMensagem.addEventListener("click", addMessage());

        function addMessage() {
            let url = "	https://api.adviceslip.com/advice";
            fetch(url).then(function (res) {
                return res.json();
            }).then(function (data) {
                mensagem = data.slip.advice;
                console.log(mensagem);
                txtMensagem.innerHTML = mensagem;
            }).catch(function (error) {
                console.log(error);
            });
        }
 
    }
    
    </script>
</body>

</html>